# 🎛️ 多功能按键控制系统

## 📝 项目概述
基于51单片机的高精度按键识别方案，支持4路按键的多态操作识别，可联动控制LED状态，搭配LCD1602实现简单数据显示。核心优势在于可靠的按键事件识别逻辑，能精准区分单击、双击、长按等复杂操作。

## 🔑 核心功能：按键识别系统

### 📊 支持的按键事件类型
| 事件宏定义       | 含义说明                          | 触发条件                                  |
|------------------|-----------------------------------|-------------------------------------------|
| `KEY_HOLD`       | 按键保持按下状态                  | 按键持续按下时一直有效                    |
| `KEY_DOWN`       | 按键按下瞬间（下降沿）            | 按键从松开变为按下的瞬间                  |
| `KEY_UP`         | 按键释放瞬间（上升沿）            | 按键从按下变为松开的瞬间                  |
| `KEY_SINGLE`     | 单击事件                          | 按下后在双击阈值内未再次按下并释放        |
| `KEY_DOUBLE`     | 双击事件                          | 两次按下间隔小于双击阈值（默认200ms）     |
| `KEY_LONG`       | 长按事件                          | 按下持续时间超过长按阈值（默认2000ms）    |
| `KEY_REPEAT`     | 长按重复触发                      | 长按期间每隔重复阈值（默认100ms）触发一次 |

### 🔌 按键硬件映射
| 按键编号 | 对应引脚  | 物理状态检测逻辑          |
|----------|-----------|---------------------------|
| `KEY_1`  | `P3_1`    | 低电平表示按下（`P3_1==0`）|
| `KEY_2`  | `P3_0`    | 低电平表示按下（`P3_0==0`）|
| `KEY_3`  | `P3_2`    | 低电平表示按下（`P3_2==0`）|
| `KEY_4`  | `P3_3`    | 低电平表示按下（`P3_3==0`）|

### 🚀 按键识别原理
1. **定时扫描机制**：基于定时器0的1ms中断，每20ms执行一次按键状态扫描（硬件消抖处理）
2. **状态机设计**：通过静态变量维护按键状态（`S[i]`），实现事件状态流转：
   - 初始状态 → 按下检测 → 长按判断 → 双击检测 → 事件触发
3. **阈值可配置**：支持通过宏定义调整关键参数：
   ```c
   #define KEY_TIME_DOUBLE 200  // 双击判断阈值(ms)
   #define KEY_TIME_LONG   2000 // 长按判断阈值(ms)
   #define KEY_TIME_REPEAT 100  // 重复触发间隔(ms)
   ```

### 💻 函数接口说明
| 函数声明                          | 功能描述                                  | 使用示例                                  |
|-----------------------------------|-------------------------------------------|-------------------------------------------|
| `void key_tick(void)`             | 按键状态扫描函数（定时器中断中调用）      | 在`Timer0_Routine`中周期性调用            |
| `uint8_t Key_Check(uint8_t n, uint8_t Flag)` | 检测指定按键的指定事件 | `if(Key_Check(KEY_1, KEY_SINGLE)) { ... }` |

## 💡 基本功能应用
1. **LED控制**：通过`led_setmode()`函数设置LED工作模式（关闭/慢速闪烁/快速闪烁）
2. **数据交互**：按键事件可用于修改数值变量（如`num1`、`num2`），并通过LCD显示
3. **扩展示例**：
   ```c
   // 长按KEY_1重复触发LED翻转
   if(Key_Check(KEY_1, KEY_REPEAT)) {
       P2_0 = ~P2_0;
   }
   // 单击KEY_2实现num2自增
   if(Key_Check(KEY_2, KEY_SINGLE)) {
       num2++;
   }
   ```

## 📄 显示模块说明
LCD1602仅作为辅助输出，支持字符、字符串、各类数字（无符号/有符号/十六进制/二进制）的指定位置显示，提供`LCD_ShowNum()`等基础接口。

## ⚙️ 系统配置
- 核心控制器：51系列单片机（如STC89C52）
- 定时器配置：12MHz晶振下，定时器0初始化为1ms中断
- 按键消抖：通过20ms扫描间隔实现硬件级消抖

## 🔧 扩展建议
- 可调整`Key.c`中的时间阈值宏以适配不同按键手感
- 支持通过组合按键实现更复杂的操作逻辑
- 可扩展按键数量（修改`KEY_COUNT`宏及对应引脚检测逻辑）
